<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../../css/profile_student.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

</head>

<body>
    <section class="container">
        <section class="container__body">
            <h3>Your Student Account</h3>
        </section>
        <form id="form">

        </form>
    </section>

</body>

</html>
<script type="module">
    import { update, laydsuser } from "/Demo_layout/js/module.js";
    async function show() {
        let dsuser = await laydsuser();
        const userDataString = sessionStorage.getItem("user");

        const userData = JSON.parse(userDataString);
        let str = ``;
        dsuser.forEach(element => {
            if (element.id == userData.id) {
                str += `
                
                <section class="container__content">
                <section class="container__body__input">
                    <label>First Name</label>
                    <input type="text" class="First_Name" name="First_Name" value="${element.First_Name}">
                    <i class="fa-solid fa-circle-check icon_edit"></i>
                </section>
                <section class="container__body__input">
                    <label>Given Name</label>
                    <input type="text" class="given_name" name="given_name" value="${element.given_name}">
                    <i class="fa-solid fa-circle-check icon_edit"></i>
                </section>
                <section class="container__body__input">
                    <label>Date of Birth</label>
                    <input type="date" class="Date of Birth" name="Date_Of_Birth" value="${element.Date_Of_Birth}">
                    <i class="fa-solid fa-circle-check icon_edit"></i>
                </section>
                <section class="container__body__input">
                    <label>Email</label>
                    <input type="email" class="Email" name="email" value="${element.email}">
                    <i class="fa-solid fa-circle-check icon_edit"></i>
                </section>
                <section class="container__body__input">
                    <label>Phone Number</label>
                    <input type="text" class="Phone_Number" name="phone_number" value="${element.phone_number}">
                    <i class="fa-solid fa-circle-check icon_edit"></i>
                </section>
                <section class="container__body__input">
                    <label>University</label>
                    <select name="university" id="" class="" value="${element.university}">
                        <option value="1" ${element.university == 1 ? 'selected' : ''}>1</option>
                         <option value="2" ${element.university == 2 ? 'selected' : ''}>2</option>
                        <option value="3" ${element.university == 3 ? 'selected' : ''}>3</option>
                    </select>
                    <i class="fa-solid fa-circle-check icon_edit"></i>
                </section>
                <section class="container__body__input">
                    <label>University Email</label>
                    <input type="text" class="University_Email" name="university_email" value="${element.university_email}">
                    <i class="fa-solid fa-circle-check icon_edit"></i>

                </section>
                <section class="container__body__input">
                    <label>Student ID</label>
                    <input type="text" class="Student ID" name="id" value="${element.id}">
                    <i class="fa-solid fa-circle-check icon_edit"></i>

                </section>
                <section class="container__body__input">
                    <label>Major</label>
                    <select name="major" id="" class="" value="">
                        <option value="1" ${element.major == 1 ? 'selected' : ''}>1</option>
                         <option value="2" ${element.major == 2 ? 'selected' : ''}>2</option>
                        <option value="3" ${element.major == 3 ? 'selected' : ''}>3</option>
                    </select>
                    <i class="fa-solid fa-circle-check icon_edit"></i>
                </section>
                <section class="container__body__input">
                    <label>GPA</label>
                    <input type="text" class="GPA" name="gpa" value="${element.gpa}">
                    <i class="fa-solid fa-circle-check icon_edit"></i>
                </section>
                <section class="container__body__input">
                    <label>Year Lever</label>
                    <select name="year_lever" id="year_lever" class="">
                         <option value="1" ${element.year_lever == 1 ? 'selected' : ''}>1</option>
                         <option value="2" ${element.year_lever == 2 ? 'selected' : ''}>2</option>
                        <option value="3" ${element.year_lever == 3 ? 'selected' : ''}>3</option>
                    </select>

                    <i class="fa-solid fa-circle-check icon_edit"></i>
                </section>

                <section class="container__body__input">
                    <label>Change your password</label>

                </section>
                <section class="container__body__input">
                    <label>Your current password</label>
                    <input type="text" class="password" name="choose_a_password" value="${element.choose_a_password}" readonly>
                    <i class="fa-solid fa-circle-check icon_edit"></i>
                </section>
                <section class="container__body__input">
                    <label>Choose a new password</label>
                    <input type="text" class="new_password" name="choose_a_password" value="" required>
                    <i class="fa-solid fa-circle-check icon_edit"></i>
                </section>
                <section class="container__body__input">
                    <label>Confirm a password</label>
                    <input type="text" class="confirm" name="confirm_password" value="" required>
                    <i class="fa-solid fa-circle-check icon_edit"></i>
                </section>

                <section class="container__body__input">
                    <button type="submit" id="btn_cancel">
                        Cancel
                    </button>
                    <button type="submit" id="btn_save">
                        Save
                    </button>
                </section>
            </section>
        </form>
    </section>
            
                
                `;

                document.querySelector("#form").innerHTML = str;
                $("#btn_cancel").click(function (event) {
                    event.preventDefault();
                    window.location.href = "../login.html"
                });
                $("#btn_save").click(function (event) {
                    event.preventDefault();

                    var formDataArray = $('#form').serializeArray();

                    // Convert array to object
                    var formDataObject = {};
                    formDataArray.forEach(function (item) {
                        if ($(".new_password").val() == "" && $(".confirm").val() == "") {
                            formDataObject[item.name] = item.value;
                            formDataObject.type = element.type;
                            formDataObject.choose_a_password = element.choose_a_password;
                            formDataObject.confirm_password = element.confirm_password;
                            sessionStorage.setItem("user", JSON.stringify(formDataObject));
                            update(formDataObject, userData.id);
                            window.localStorage.href = `../profile/student.html?id=${userData.id}`;

                        } else {
                            formDataObject[item.name] = item.value;
                            formDataObject.type = element.type;
                            sessionStorage.setItem("user", JSON.stringify(formDataObject));
                            update(formDataObject, userData.id);
                            window.localStorage.href = `../profile/student.html?id=${userData.id}`;
                        }
                    });

                });

            }

        });


    }
    show();





</script>